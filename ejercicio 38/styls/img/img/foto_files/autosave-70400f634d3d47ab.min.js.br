"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="b6a2055c-4e3e-5e0a-a5b5-b77ea8116d61")}catch(e){}}();
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[5817],{20100:(e,t,a)=>{a.d(t,{Ay:()=>d,DA:()=>v,DD:()=>l,IC:()=>_,Jm:()=>s,MV:()=>c,O2:()=>m,QW:()=>y,Vz:()=>u,dd:()=>i,eX:()=>o,fH:()=>E,hL:()=>f,ho:()=>r,ns:()=>h,rf:()=>n});let l="autosave_modal--title--Q-T-o",n="autosave_modal--body--pv4yP",s="autosave_modal--openFilesToSyncText--DI5lk",o="autosave_modal--fileRows--JQWy9",r="autosave_modal--fileRow--vBNLB",i="autosave_modal--userRows--fG3Qq",u="autosave_modal--onlyFileRow--yr2jI autosave_modal--fileRow--vBNLB autosave_modal--body--pv4yP",c="autosave_modal--onlyFileRowText--NGT-7",m="autosave_modal--userTitle--lEP2M ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd",d="autosave_modal--fileMetadata--JIecy",v="autosave_modal--fileTitle--L9HsU ellipsis--ellipsis--Tjyfa",f="autosave_modal--fileLastUpdatedAt--ZL15q ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd",E="autosave_modal--expiryWrapper--1Ee1U",_="autosave_modal--expiry--E2Ybr",y="autosave_modal--warningIcon--T1wLu",h="autosave_modal--openToSync--KQUfj"},846007:(e,t,a)=>{a.r(t),a.d(t,{AutosaveLearnMoreModal:()=>c});var l=a(411855),n=a(775448),s=a(463033),o=a(195909),r=a(256659),i=a(301929),u=a(20100);function c(e){let t=n.hS(e),a=l.createElement(s.$n,{variant:"secondary",onClick:e.onClose},(0,i.tx)("autosave.learn_more.done_button"));return l.createElement(o.bL,{manager:t,width:"lg"},l.createElement(r.vo,null,l.createElement(r.Y9,null,l.createElement(r.hE,null,(0,i.tx)("autosave.learn_more.title"))),l.createElement(r.nB,null,l.createElement("div",null,(0,i.tx)("autosave.learn_more.body_save_pending_changes")),l.createElement("div",{className:u.rf},(0,i.tx)("autosave.learn_more.body_use_version_history"))),l.createElement(r.wi,null,l.createElement(r.jk,null,a))))}},399374:(e,t,a)=>{a.r(t),a.d(t,{AutosaveLogOutModal:()=>X,HasAutosaveChangesModal:()=>H});var l=a(411855),n=a(188507),s=a(561546),o=a(838516),r=a(268853),i=a(463033),u=a(195909),c=a(256659),m=a(775448),d=a(677469),v=a.n(d),f=a(463695),E=a(136189),_=a(248591),y=a(237798),h=a(438347),g=a(171946),p=a(480423),x=a(828028),N=a(182295),w=a(579557),A=a(301929),b=a(767164),k=a(492841),C=a(788193),L=a(737825),F=a(822326),D=a(60897),S=a(686644),O=a(781505),T=a(412409),j=a(568113),$=a(878206),M=a(841330),U=a(20100),B=a(247866);function I(e){return e.user?l.createElement("div",{className:U.O2},l.createElement("p",null,e.user.community_profile_handle||e.user.email)):null}async function G(e,t){let a=!1,l=null;try{let{data:n}=await M.S.getFiles({includePerms:!0,fileKey:t.fileKey,args:{headers:{"X-Figma-User-ID":e}}});(l=n.meta)&&(l.deleted_at||!l.can_edit_canvas)&&(a=!0)}catch(e){404===e.status?a=!0:(0,y.Lo)("Autosave","Failed to retrieve information about autosave file")}return{userID:e,shouldDeleteFile:a,unsyncedFile:t,figFile:l}}let P=(e,t)=>(0,o.s)(()=>{let a=new URL((0,O.r1)(T.F.toLiveGraph(e),!0));a.searchParams.append("fuid",t),E.Ay.redirect(a.toString(),"_blank")}),R=(e,t)=>(0,o.s)(()=>e(b.NA({file:t,openNewFileIn:$.ai.NEW_TAB,source:j.U.AUTOSAVE_MODAL})));function K(e,t,a){return(0,F.y8)(t)?{fileName:t.file.name,onClick:P(t.file,a.id),thumbnail:l.createElement(p.NU,{file:t.file,size:N.y.SMALL,borderRadius:4})}:{fileName:t.name,onClick:R(e,t),thumbnail:l.createElement(x.A,{listView:"slightly-larger"})}}function Q(e){let{fileName:t,onClick:a,thumbnail:s}=K((0,n.wA)(),e.fileState,e.user);return l.createElement("div",{className:U.ho,key:e.fileState.fileKey},l.createElement("div",{className:w.cx.hFull.$},s),l.createElement("div",{className:U.Ay},l.createElement("div",{className:U.DA},t),l.createElement("div",{className:U.hL},(0,A.tx)("tile.file_tile.edited_time",{time:l.createElement(h.h1,{date:e.fileState.lastUpdatedAt})}))),l.createElement("div",{className:U.ns},l.createElement(i.$n,{variant:"secondary",onClick:a},(0,A.tx)("autosave.has_changes.open_to_sync"))))}function W(e){return l.createElement("div",{className:U.dd},Object.keys(e.files).map(t=>l.createElement("div",{key:t,className:U.eX},l.createElement(I,{user:e.users.filter(e=>e?.id===t)[0]}),l.createElement("div",null,Object.values(e.files[t]).map(a=>l.createElement(Q,{fileState:a,user:e.users.filter(e=>e?.id===t)[0],key:a.fileKey}))))))}function Y({modalManager:e,files:t,nextGarbageCollectionTimestamp:a,users:s,includeDismissButton:o,onDone:r}){let m;let d=(0,n.wA)(),f=r||(()=>{d(k.Ce())}),E=J(a),_=(0,A.tx)("autosave.has_changes.sync_offline_changes"),y=1===v()(Object.values(t)).length,h=null,p=null,x=null,N=null,b=null;if(y){h=v()(Object.values(t))[0];let e=Object.keys(t).filter(e=>t[e].length>0)[0],a=K(d,h,p=s.filter(t=>t?.id===e)[0]);x=a.fileName,N=a.onClick,b=a.thumbnail,m=l.createElement(l.Fragment,null,l.createElement(I,{user:p}),l.createElement("div",{className:U.Vz},l.createElement("div",{className:w.cx.hFull.$},b),l.createElement("div",{className:U.MV},(0,A.tx)("autosave.has_changes.unsaved_changes_to_file",{fileName:l.createElement("span",{className:U.DD},x)}))))}else m=l.createElement(l.Fragment,null,l.createElement("div",{className:U.Jm},(0,A.tx)("autosave.has_changes.unsynced_changes_offline")),l.createElement(W,{files:t,users:s}));let C=E&&l.createElement("div",{className:U.fH},l.createElement(g.B,{svg:B.A,className:U.QW}),l.createElement("div",{className:U.IC},E)),L=o&&l.createElement(i.$n,{variant:"secondary",onClick:f},(0,A.tx)("autosave.has_changes.dismiss.later")),F=y&&N&&l.createElement(i.$n,{variant:"primary",onClick:N},(0,A.tx)("autosave.has_changes.open_to_sync"));return l.createElement(u.bL,{manager:e,width:"lg"},l.createElement(c.vo,null,l.createElement(c.Y9,null,l.createElement(c.hE,null,_)),l.createElement(c.nB,null,m),(C||L||F)&&l.createElement(c.wi,null,C,(L||F)&&l.createElement(c.jk,null,L,F))))}function H(e){let t=m.hS(e),{unsyncedFiles:a,localUnsyncedFiles:s}=(0,C.Gg)(),o=(0,n.d4)(e=>e.modalShown),r=(0,n.d4)(e=>e.autosave.nextGarbageCollectionTimestamp),i=(0,S.iZ)(),u=i?.id;return o&&u&&i?l.createElement(Y,{modalManager:t,files:{[u]:[...a,...s]},nextGarbageCollectionTimestamp:r,users:[i],includeDismissButton:!0}):null}function V(e){let t=m.hS(e),a=(0,n.wA)(),[s,o]=l.useState(!1),[r,d]=l.useState(!1),v=async()=>{try{for(let t of e.users){let e=t?.id;e&&await (0,C.go)((0,L.cu)(e))}}finally{d(!0)}},E=()=>{o(!0)},_=0===Object.values(e.files).length;if(r||_&&e.loaded){let a=(0,A.tx)("autosave.logout.offline_changes"),n=r?(0,A.tx)("autosave.logout.offline_changes_discarded"):(0,A.tx)("autosave.logout.offline_changes_synced"),s=l.createElement(i.$n,{variant:"secondary",onClick:e.onLogOut},(0,A.tx)("autosave.logout.log_out"));return l.createElement(u.bL,{width:"md",manager:t},l.createElement(c.vo,null,l.createElement(c.Y9,null,l.createElement(c.hE,null,a)),l.createElement(c.nB,null,n),l.createElement(c.wi,null,l.createElement(c.jk,null,s))))}if(s)return l.createElement(Y,{...e,modalManager:t,onDone:()=>{o(!1)}});{let n,s,o;let r=(0,A.tx)("autosave.has_changes.sync_offline_changes"),m=f.eD?(0,A.t)("autosave.logout.log_out_text.desktop"):(0,A.t)("autosave.logout.log_out_text.web");return f.eD?(n=l.createElement(i.$n,{variant:"destructiveSecondary",onClick:v},(0,A.tx)("autosave.logout.discard_and_logout")),s=l.createElement(i.$n,{variant:"secondary",onClick:()=>{a(k.Lo())}},(0,A.tx)("autosave.logout.cancel")),o=l.createElement(i.$n,{variant:"secondary",onClick:E},(0,A.tx)("autosave.logout.show_changes"))):(n=l.createElement(i.$n,{variant:"destructiveSecondary",onClick:v},(0,A.tx)("autosave.logout.discard")),s=l.createElement(i.$n,{variant:"secondary",onClick:e.onLogOut},(0,A.tx)("autosave.logout.log_out")),o=l.createElement(i.$n,{variant:"primary",onClick:E},(0,A.tx)("autosave.logout.sync_changes"))),l.createElement(u.bL,{manager:t,width:"lg"},l.createElement(c.vo,null,l.createElement(c.Y9,null,l.createElement(c.hE,null,r)),l.createElement(c.nB,null,m),l.createElement(c.wi,null,n,l.createElement(c.jk,null,s,o))))}}function X(e){let{multiUserUnsyncedFiles:t,multiUserGarbageCollectionTimestamp:a,loaded:o,autosaveFilesToDelete:i}=function(e){let t=(0,n.wA)(),[a,o]=l.useState({multiUserGarbageCollectionTimestamp:0,multiUserUnsyncedFiles:{},loaded:!1,autosaveFilesToDelete:[]});return l.useEffect(()=>{let t=async()=>{try{let t=await (0,C.ZW)((0,s.WI)(e.map(e=>e?.id))),a={},l=[],n=[];for(let[e,l]of Object.entries(t)){for(let t of l.unsyncedFiles)n.push(G(e,t));for(let t of l.newFiles)e in a||(a[e]=[]),a[e].push(t)}for(let e of(await Promise.all(n))){let t=e.userID;e.shouldDeleteFile?l.push({userID:t,fileKey:e.unsyncedFile.fileKey}):e.figFile&&(t in a||(a[t]=[]),a[t].push({type:"autosave-file",fileKey:e.figFile.key,lastUpdatedAt:e.unsyncedFile.lastUpdatedAt,file:e.figFile}))}let r=Math.min(...Object.values(t).map(e=>e.nextGarbageCollectionTimestamp));o({multiUserGarbageCollectionTimestamp:r,multiUserUnsyncedFiles:a,loaded:!0,autosaveFilesToDelete:l})}catch(e){e instanceof Error?((0,y.x1)("Autosave","Failed to call autosave callback",{name:e.name,message:e.message}),(0,_.$D)(r.e.SCENEGRAPH_AND_SYNC,e)):(0,_.$D)(r.e.SCENEGRAPH_AND_SYNC,Error("Failed to call autosave callback"))}};return D.hp.register(D.a,t),t(),function(){D.hp.unregister(D.a,t)}},[t,e]),a}(e.users);return(0,S.TA)()?l.createElement(V,{...e,loaded:o,nextGarbageCollectionTimestamp:a,files:t,onLogOut:()=>{for(let e of i)(0,C.go)((0,L.Zt)(e.userID,e.fileKey)).catch(e=>{(0,_.$D)(r.e.UNOWNED,Error("Failed to delete autosave data for sessions"))});e.onLogOut()},users:e.users}):null}H.displayName="HasAutosaveChangesModal";let J=e=>{let t=Math.floor(((0,C.bD)()-(Date.now()-e))/864e5);return t>5?null:t<1?(0,A.tx)("autosave.has_changes.expiry_text_shortly"):(0,A.tx)("autosave.has_changes.expiry_text_days",{days:t})};X.displayName="AutosaveLogOutModal"},105018:(e,t,a)=>{a.r(t),a.d(t,{AutosaveNewFileAlreadyOpenModal:()=>v});var l=a(411855),n=a(188507),s=a(775448),o=a(195909),r=a(256659),i=a(463033),u=a(196302),c=a(579557),m=a(301929),d=a(492841);function v(e){let t=(0,n.wA)();(0,l.useEffect)(()=>(0,u.sx)("New Autosave File Already Open Modal Shown"));let a=()=>t(d.Ce()),v=s.hS({open:!0,onClose:a});return l.createElement(o.bL,{manager:v,width:360},l.createElement(r.vo,null,l.createElement(r.Y9,null,l.createElement(r.hE,null,(0,m.tx)("autosave.file_already_open_modal.title"))),l.createElement(r.nB,null,(0,m.tx)("autosave.file_already_open_modal.body",{fileName:l.createElement("span",{className:c.cx.fontSemiBold.$},e.file.name)})),l.createElement(r.wi,null,l.createElement(r.jk,null,l.createElement(i.$n,{variant:"secondary",onClick:a},(0,m.tx)("general.ok"))))))}v.displayName="AutosaveNewFileAlreadyOpenModal"}}]);

//# debugId=b6a2055c-4e3e-5e0a-a5b5-b77ea8116d61

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/5fb63f7aaaa969b390b66f9a63b8567f432c4434/autosave-70400f634d3d47ab.min.js.map